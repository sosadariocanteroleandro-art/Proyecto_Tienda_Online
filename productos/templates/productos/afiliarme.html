{% extends 'base.html' %}
{% load humanize %}

{% block title %}Afiliarme - Tu Tienda{% endblock %}

{% block content %}
    <!-- Header -->
    <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-4">
            üöÄ Af√≠liate y Gana Dinero
        </h1>
        <p class="text-lg text-gray-600 mb-8 max-w-3xl mx-auto">
            √önete a nuestro programa de afiliados y comienza a generar ingresos promocionando productos incre√≠bles.
            Es <span class="font-bold text-green-600">completamente gratis</span> y sin compromisos.
        </p>

        <!-- Stats Overview -->
        <div class="stats-card rounded-2xl p-6 max-w-4xl mx-auto shadow-lg">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600">{{ productos_fisicos|length|add:productos_digitales|length }}</div>
                    <div class="text-gray-600 font-medium">Productos Disponibles</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600">15%</div>
                    <div class="text-gray-600 font-medium">Comisi√≥n Promedio</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-600">24/7</div>
                    <div class="text-gray-600 font-medium">Soporte Disponible</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Filtros y b√∫squeda -->
    <div class="glass-card rounded-2xl p-6 mb-8 shadow-lg">
        <div class="flex flex-wrap gap-4 items-center justify-between">
            <div class="flex gap-2">
                <button onclick="showAll()" class="filter-btn bg-blue-500 text-white px-4 py-2 rounded-full font-medium transition duration-300 hover:bg-blue-600">
                    Todos los Productos
                </button>
                <button onclick="showFisicos()" class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full font-medium transition duration-300 hover:bg-gray-300">
                    Solo F√≠sicos ({{ productos_fisicos|length }})
                </button>
                <button onclick="showDigitales()" class="filter-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-full font-medium transition duration-300 hover:bg-gray-300">
                    Solo Digitales ({{ productos_digitales|length }})
                </button>
            </div>
            <div class="text-sm text-gray-600 font-medium">
                üí° Tip: Los productos digitales suelen tener mayor margen de ganancia
            </div>
        </div>
    </div>

    <!-- Productos F√≠sicos -->
    <div id="seccion-fisicos" class="mb-16">
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center">
                <h2 class="text-3xl font-bold text-gray-800 mr-4">üì¶ Productos F√≠sicos</h2>
                <span class="badge-fisico text-white text-sm font-bold px-3 py-1 rounded-full">
                    {{ productos_fisicos|length }} disponible{{ productos_fisicos|length|pluralize }}
                </span>
            </div>
            <div class="text-sm text-gray-600">
                Comisi√≥n: <span class="font-bold text-blue-600">10-20%</span>
            </div>
        </div>

        {% if productos_fisicos %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for producto in productos_fisicos %}
            <div class="glass-card product-card rounded-2xl shadow-lg overflow-hidden group">
                <div class="relative">
                    <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="w-full h-56 object-cover"
                         onerror="this.src='https://placehold.co/600x400/3b82f6/fff?text={{ producto.nombre|slice:':3' }}'">
                    <div class="absolute top-3 right-3">
                        <span class="badge-fisico text-white text-xs font-bold px-3 py-1 rounded-full">üì¶ F√≠sico</span>
                    </div>
                    <div class="absolute top-3 left-3">
                        <span class="bg-yellow-500 text-white text-xs font-bold px-2 py-1 rounded-full">‚≠ê Popular</span>
                    </div>
                </div>

                <div class="p-5">
                    <h3 class="font-bold text-lg text-gray-800 mb-2 group-hover:text-blue-600 transition duration-300">
                        {{ producto.nombre }}
                    </h3>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">{{ producto.descripcion }}</p>

                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <span class="text-2xl font-bold text-green-600">‚Ç≤{{ producto.precio|intcomma }}</span>
                            <div class="text-xs text-gray-500">Tu comisi√≥n: ~‚Ç≤{{ producto.precio|floatformat:0|add:"000"|slice:":-3" }}0</div>
                        </div>
                    </div>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-xs text-gray-600">
                            <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                            Env√≠o r√°pido disponible
                        </div>
                        <div class="flex items-center text-xs text-gray-600">
                            <span class="w-2 h-2 bg-blue-400 rounded-full mr-2"></span>
                            Material promocional incluido
                        </div>
                    </div>

                    <form action="{% url 'productos:afiliar_producto' producto.id %}" method="post"
                          onsubmit="return confirm('¬øConfirmas que quieres afiliarte a {{ producto.nombre }}?')">
                        {% csrf_token %}
                        <button type="submit"
                                class="affiliate-btn-fisico w-full text-white py-3 px-4 rounded-xl text-center font-bold text-sm transition duration-300 transform hover:scale-105">
                            üöÄ Afiliarme Ahora
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 bg-gray-50 rounded-2xl">
            <div class="text-4xl mb-4">üì¶</div>
            <p class="text-gray-600 text-lg">No hay productos f√≠sicos disponibles en este momento.</p>
            <p class="text-gray-500 text-sm mt-2">¬°Pronto agregaremos m√°s productos incre√≠bles!</p>
        </div>
        {% endif %}
    </div>

    <!-- Productos Digitales -->
    <div id="seccion-digitales">
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center">
                <h2 class="text-3xl font-bold text-gray-800 mr-4">üíª Productos Digitales</h2>
                <span class="badge-digital text-white text-sm font-bold px-3 py-1 rounded-full">
                    {{ productos_digitales|length }} disponible{{ productos_digitales|length|pluralize }}
                </span>
            </div>
            <div class="text-sm text-gray-600">
                Comisi√≥n: <span class="font-bold text-green-600">15-30%</span>
            </div>
        </div>

        {% if productos_digitales %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {% for producto in productos_digitales %}
            <div class="glass-card product-card rounded-2xl shadow-lg overflow-hidden group">
                <div class="relative">
                    <img src="{{ producto.imagen.url }}" alt="{{ producto.nombre }}" class="w-full h-56 object-cover"
                         onerror="this.src='https://placehold.co/600x400/10b981/fff?text={{ producto.nombre|slice:':3' }}'">
                    <div class="absolute top-3 right-3">
                        <span class="badge-digital text-white text-xs font-bold px-3 py-1 rounded-full">üíª Digital</span>
                    </div>
                    <div class="absolute top-3 left-3">
                        <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">üî• Trending</span>
                    </div>
                </div>

                <div class="p-5">
                    <h3 class="font-bold text-lg text-gray-800 mb-2 group-hover:text-green-600 transition duration-300">
                        {{ producto.nombre }}
                    </h3>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-2">{{ producto.descripcion }}</p>

                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <span class="text-2xl font-bold text-green-600">‚Ç≤{{ producto.precio|intcomma }}</span>
                            <div class="text-xs text-gray-500">Tu comisi√≥n: ~‚Ç≤{{ producto.precio|floatformat:0|add:"000"|slice:":-3" }}5</div>
                        </div>
                    </div>

                    <div class="space-y-2 mb-4">
                        <div class="flex items-center text-xs text-gray-600">
                            <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                            Entrega instant√°nea
                        </div>
                        <div class="flex items-center text-xs text-gray-600">
                            <span class="w-2 h-2 bg-purple-400 rounded-full mr-2"></span>
                            Mayor margen de ganancia
                        </div>
                    </div>

                    <form action="{% url 'productos:afiliar_producto' producto.id %}" method="post"
                          onsubmit="return confirm('¬øConfirmas que quieres afiliarte a {{ producto.nombre }}?')">
                        {% csrf_token %}
                        <button type="submit"
                                class="affiliate-btn-digital w-full text-white py-3 px-4 rounded-xl text-center font-bold text-sm transition duration-300 transform hover:scale-105">
                            üíé Afiliarme Ahora
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-12 bg-gray-50 rounded-2xl">
            <div class="text-4xl mb-4">üíª</div>
            <p class="text-gray-600 text-lg">No hay productos digitales disponibles en este momento.</p>
            <p class="text-gray-500 text-sm mt-2">¬°Pronto agregaremos m√°s productos incre√≠bles!</p>
        </div>
        {% endif %}
    </div>

    <!-- CTA Final -->
    <div class="glass-card rounded-3xl p-8 mt-16 text-center shadow-2xl">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">üéØ ¬øListo para comenzar a generar ingresos?</h3>
        <p class="text-gray-600 mb-6 max-w-2xl mx-auto">
            √önete a miles de afiliados que ya est√°n generando ingresos pasivos con nuestros productos.
            Sin costos iniciales, sin compromisos a largo plazo.
        </p>
        <div class="flex flex-wrap gap-4 justify-center">
            <div class="text-center">
                <div class="text-xl font-bold text-green-600">‚Ç≤2.5M+</div>
                <div class="text-sm text-gray-600">Generado por afiliados</div>
            </div>
            <div class="text-center">
                <div class="text-xl font-bold text-blue-600">500+</div>
                <div class="text-sm text-gray-600">Afiliados activos</div>
            </div>
            <div class="text-center">
                <div class="text-xl font-bold text-purple-600">4.8‚òÖ</div>
                <div class="text-sm text-gray-600">Calificaci√≥n promedio</div>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_css %}
<style>
    .product-card {
        transition: all 0.3s ease;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }
    .affiliate-btn-fisico {
        background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        transition: all 0.3s ease;
    }
    .affiliate-btn-fisico:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
    }
    .affiliate-btn-digital {
        background: linear-gradient(45deg, #10b981, #059669);
        transition: all 0.3s ease;
    }
    .affiliate-btn-digital:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }
    .message-success {
        animation: slideDown 0.5s ease-out;
    }
    @keyframes slideDown {
        from { transform: translateY(-20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    .stats-card {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
    }
    .badge-fisico {
        background: linear-gradient(45deg, #3b82f6, #1d4ed8);
    }
    .badge-digital {
        background: linear-gradient(45deg, #10b981, #059669);
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    function updateFilterButtons(activeBtn) {
        const filterBtns = document.querySelectorAll('.filter-btn');
        filterBtns.forEach(btn => {
            btn.classList.remove('bg-blue-500', 'text-white');
            btn.classList.add('bg-gray-200', 'text-gray-700');
        });
        activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
        activeBtn.classList.add('bg-blue-500', 'text-white');
    }

    function showAll() {
        document.getElementById('seccion-fisicos').style.display = 'block';
        document.getElementById('seccion-digitales').style.display = 'block';
        updateFilterButtons(event.target);
    }

    function showFisicos() {
        document.getElementById('seccion-fisicos').style.display = 'block';
        document.getElementById('seccion-digitales').style.display = 'none';
        updateFilterButtons(event.target);
    }

    function showDigitales() {
        document.getElementById('seccion-fisicos').style.display = 'none';
        document.getElementById('seccion-digitales').style.display = 'block';
        updateFilterButtons(event.target);
    }

    setTimeout(() => {
        const messages = document.querySelectorAll('.message-success');
        messages.forEach(message => {
            message.style.animation = 'slideUp 0.5s ease-in forwards';
        });
    }, 5000);

    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideUp {
            to {
                transform: translateY(-20px);
                opacity: 0;
                display: none;
            }
        }
    `;
    document.head.appendChild(style);
</script>
{% endblock %}